import{M as k,D as y}from"./DeleteProductModal-1Ba96p-Y.js";import{_ as P,r as u,o as c,c as p,a as e,b as d,w as D,n as w,k as v,E as x,J as V,t as C,F as M,g as I}from"./index-LwfYF3F_.js";import{P as S}from"./PaginationCom-ohgWUvKv.js";import{S as _}from"./sweetalert2.all-cav2bzh3.js";const A={props:["tempCoupon","isNew"],data(){return{couponModal:"",tempCoupons:{},due_date:"",minDateISO:""}},methods:{open(){this.couponModal.show()},close(){this.couponModal.hide(),this.$emit("getProducts")},changestatus(o){this.$emit("updateCoupon",o)}},watch:{tempCoupon(){this.tempCoupons=this.tempCoupon;const o=new Date(this.tempCoupons.due_date*1e3).toISOString().split("T");[this.due_date]=o},due_date(o){const t=new Date;t.setHours(0,0,0,0),new Date(o)<t&&(this.due_date=this.minDateISO)}},mounted(){const o=new Date;o.setDate(o.getDate()),this.minDateISO=o.toISOString().split("T")[0],this.couponModal=new k(this.$refs.couponModal,{keyboard:!1,backdrop:"static"})}},N={class:"modal fade",ref:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},$={class:"modal-dialog",role:"document"},E={class:"modal-content"},U={class:"modal-header"},B={class:"modal-title",id:"exampleModalLabel"},L={key:0},T={key:1},O=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),G={class:"modal-body"},R={class:"mb-3"},q=e("label",{for:"title"},"標題",-1),F={class:"mb-3"},z=e("label",{for:"coupon_code"},"優惠碼",-1),H={class:"mb-3"},J=e("label",{for:"due_date"},"到期日",-1),j=["min"],K={class:"mb-3"},Q=e("label",{for:"price"},"折扣百分比",-1),W={class:"mb-3"},X=e("span",null,"啟用狀態",-1),Y={class:"form-check form-switch"},Z={class:"form-check-label",for:"is_enabled"},ee={key:0},oe={key:1},te={class:"modal-footer"};function se(o,t,n,h,s,l){const r=u("v-field"),m=u("error-message"),g=u("v-form");return c(),p("div",N,[e("div",$,[e("div",E,[e("div",U,[e("h5",B,[n.isNew?(c(),p("span",L,"新增優惠券")):(c(),p("span",T,"編輯優惠券"))]),O]),e("div",G,[d(g,{ref:"form"},{default:D(({errors:a})=>[e("div",R,[q,d(r,{type:"text",name:"標題",class:w(["form-control",{"is-invalid":a.標題}]),id:"title",modelValue:s.tempCoupons.title,"onUpdate:modelValue":t[0]||(t[0]=i=>s.tempCoupons.title=i),placeholder:"請輸入標題",rules:"required"},null,8,["modelValue","class"]),d(m,{name:"標題",class:"invalid-feedback"})]),e("div",F,[z,d(r,{type:"text",name:"優惠碼",class:w(["form-control",{"is-invalid":a.優惠碼}]),id:"coupon_code",modelValue:s.tempCoupons.code,"onUpdate:modelValue":t[1]||(t[1]=i=>s.tempCoupons.code=i),placeholder:"請輸入優惠碼",rules:"required"},null,8,["modelValue","class"]),d(m,{name:"優惠碼",class:"invalid-feedback"})]),e("div",H,[J,v(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[2]||(t[2]=i=>s.due_date=i),min:s.minDateISO},null,8,j),[[x,s.due_date]])]),e("div",K,[Q,d(r,{type:"number",name:"折扣百分比",min:"0",max:"100",class:w(["form-control",{"is-invalid":a.折扣百分比}]),id:"price",modelValue:s.tempCoupons.percent,"onUpdate:modelValue":t[3]||(t[3]=i=>s.tempCoupons.percent=i),modelModifiers:{number:!0},placeholder:"請輸入折扣百分比",rules:"required"},null,8,["modelValue","class"]),d(m,{name:"折扣百分比",class:"invalid-feedback"})]),e("div",W,[X,e("div",Y,[v(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=i=>s.tempCoupons.is_enabled=i),id:"is_enabled"},null,512),[[V,s.tempCoupons.is_enabled]]),e("label",Z,[s.tempCoupons.is_enabled?(c(),p("span",ee,"已啟用")):(c(),p("span",oe,"未啟用"))])])])]),_:1},512)]),e("div",te,[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",onClick:t[5]||(t[5]=(...a)=>l.close&&l.close(...a))},"Close"),e("button",{type:"button",class:"btn btn-primary",onClick:t[6]||(t[6]=()=>l.changestatus(s.tempCoupons))},C(n.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}const ne=P(A,[["render",se]]);var le={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"leo535",BASE_URL:"/flash-taste/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:f,VITE_APP_API_NAME:b}=le,ae={data(){return{couponList:[],page:{},tempCoupon:{title:"",is_enabled:0,percent:100,code:""},isNew:!1}},methods:{getCoupon(o=1){const t=this.$loading.show();this.axios.get(`${f}/api/${b}/admin/coupons/?page=${o}`).then(n=>{this.couponList=n.data.coupons,this.page=n.data.pagination,t.hide()}).catch(n=>{_.fire({position:"top-end",icon:"error",title:n.response.data.message,showConfirmButton:!1,timer:1500})})},openModal(o,t){o==="new"?(this.tempCoupon={due_date:new Date().getTime()/1e3,is_enabled:1},this.isNew=!0):o==="edit"&&(this.tempCoupon={...t},this.isNew=!1),this.$refs.couponModal.open()},updateCoupon(o){if(o.percent>100||o.percent<=0)return _.fire({position:"top-end",icon:"error",title:"折扣百分比不能為負值或100以上",showConfirmButton:!1,timer:1500}),0;let t="post",n=o,h=`${f}/api/${b}/admin/coupon`;this.isNew||(h=`${f}/api/${b}/admin/coupon/${this.tempCoupon.id}`,t="put",n=this.tempCoupon),this.axios[t](h,{data:n}).then(s=>{_.fire({position:"top-end",icon:"success",title:s.data.message,showConfirmButton:!1,timer:1500}),this.$refs.couponModal.close(),this.getCoupon()}).catch(s=>{alert(s.response.data.message)})},deleteCouponModal(o){this.tempCoupon={...o},this.$refs.deleteProductmodal.open()},deleteCoupon(){this.axios.delete(`${f}/api/${b}/admin/coupon/${this.tempCoupon.id}`).then(o=>{_.fire({position:"top-end",icon:"success",title:o.data.message,showConfirmButton:!1,timer:1500}),this.getCoupon(),this.$refs.deleteProductmodal.close()}).catch(o=>{_.fire({position:"top-end",icon:"error",title:o.response.data.message,showConfirmButton:!1,timer:1500})})}},components:{CouponModalView:ne,DeleteProductModal:y,PaginationCom:S},mounted(){this.getCoupon()}},ie=e("h2",null,"優惠券管理",-1),de={class:"py-0"},ce={class:"text-end mt-4"},pe={class:"table-responsive"},ue={class:"table mt-4 mb-3"},re=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",{class:"text-nowrap"},"折扣百分比"),e("th",null,"到期日"),e("th",{class:"text-nowrap"},"啟用狀態"),e("th",null,"操作行為")])],-1),me={class:"text-nowrap"},_e={key:0,class:"text-success"},he={key:1,class:"text-muted"},fe={class:"text-nowrap"},be={class:"btn-group"},Ce=["onClick"],ge=["onClick"];function we(o,t,n,h,s,l){const r=u("CouponModalView"),m=u("DeleteProductModal"),g=u("PaginationCom");return c(),p(M,null,[ie,e("div",de,[e("div",ce,[e("button",{class:"btn btn-primary",type:"button",onClick:t[0]||(t[0]=()=>l.openModal("new"))}," 建立新的優惠券 ")]),e("div",pe,[e("table",ue,[re,e("tbody",null,[(c(!0),p(M,null,I(s.couponList,(a,i)=>(c(),p("tr",{key:i},[e("td",me,C(a.title),1),e("td",null,C(a.percent)+"%",1),e("td",null,C(o.$filters.date(a.due_date)),1),e("td",null,[a.is_enabled===1?(c(),p("span",_e,"啟用")):(c(),p("span",he,"未啟用"))]),e("td",fe,[e("div",be,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:()=>l.openModal("edit",a)},"編輯",8,Ce),e("button",{class:"btn btn-outline-danger btn-sm",onClick:()=>l.deleteCouponModal(a)},"刪除",8,ge)])])]))),128))])])]),d(r,{ref:"couponModal",onGetProducts:l.getCoupon,"temp-coupon":s.tempCoupon,"is-new":s.isNew,onUpdateCoupon:l.updateCoupon},null,8,["onGetProducts","temp-coupon","is-new","onUpdateCoupon"]),d(m,{ref:"deleteProductmodal",onGetProducts:l.getCoupon,"temp-product":s.tempCoupon,onDeleteData:l.deleteCoupon,id:3},null,8,["onGetProducts","temp-product","onDeleteData"]),d(g,{"page-info":s.page,onGetProducts:l.getCoupon},null,8,["page-info","onGetProducts"])])],64)}const ye=P(ae,[["render",we]]);export{ye as default};
