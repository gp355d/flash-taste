import{M as A,D as I}from"./DeleteProductModal-3WYWA0IE.js";import{C as E}from"./ckeditor-zFUgWV58.js";import{S as f}from"./sweetalert2.all-pUKmrL9Z.js";import{_ as k,r as h,o as n,c,a as e,k as y,E as V,j as g,i as D,F as M,g as C,b as a,w as L,n as P,J as R,t as v}from"./index-Tl3ByFI-.js";import{P as N}from"./PaginationCom-Pe2SBvY8.js";var T={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"leo535",BASE_URL:"/flash-taste/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:B,VITE_APP_API_NAME:F}=T,S={props:["tempProduct","isNew"],data(){return{productModal:"",delProductModal:"",file:"",tempProducts:{},editor:E,editorConfig:{toolbar:["heading","|","bold","italic","link","bulletedList","numberedList","blockQuote","undo","redo"]}}},watch:{tempProduct(){this.tempProducts=this.tempProduct,this.tempProduct.imagesUrl||(this.tempProducts.imagesUrl=[]),this.tempProduct.imageUrl||(this.tempProducts.imageUrl="")}},methods:{open(){this.productModal.show()},close(){this.productModal.hide(),this.$emit("getProducts")},updateProduct(){this.$emit("updateData")},createImages(){this.$emit("createImg")},uploadFile(i){const[t]=i.target.files;this.file=t,t&&(this.tempProducts.imgPreviewURL=window.URL.createObjectURL(t))},upload(){const i=this.$refs.files.files[0],t=new FormData;t.append("file-to-upload",i);const d=`${B}/api/${F}/admin/upload`;this.axios.post(d,t,{headers:{"Content-Type":"multipart/form-data"}}).then(m=>{m.data.success&&(this.tempProducts.imageUrl=m.data.imageUrl,this.tempProducts.imgPreviewURL="")}).catch(m=>{f.fire({position:"top-end",icon:"error",title:m.response.data.message,showConfirmButton:!1,timer:1500})})}},mounted(){this.productModal=new A(this.$refs.productModal,{keyboard:!1,backdrop:"static",focus:!1})}},G={ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},q={class:"modal-dialog modal-xl"},O={class:"modal-content border-0"},j={class:"modal-header bg-dark text-white"},z={id:"productModalLabel",class:"modal-title"},J={key:0},Q={key:1},H={class:"modal-body"},K={class:"row"},W={class:"col-sm-4"},X=e("h3",null,"主要圖片",-1),Y=["src","alt"],Z=["src"],$=["disabled"],ee=e("h3",null,"新增多圖",-1),te={key:2,class:"mb-2"},oe=e("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),se=["onUpdate:modelValue"],le=["src","alt"],ie={class:"mb-3"},de=e("label",{for:"title",class:"form-label"},"標題",-1),re={class:"row"},ae={class:"mb-3 col-md-6"},ne=e("label",{for:"category",class:"form-label"},"分類",-1),ce={class:"mb-3 col-md-6"},ue=e("label",{for:"price",class:"form-label"},"單位",-1),me={class:"row"},pe={class:"mb-3 col-md-6"},_e=e("label",{for:"origin_price",class:"form-label"},"原價",-1),he={class:"mb-3 col-md-6"},fe=e("label",{for:"price",class:"form-label"},"售價",-1),Pe=e("hr",null,null,-1),be={class:"mb-3"},ge=e("label",{for:"description",class:"form-label"},"產品描述",-1),ve={class:"mb-3"},we=e("label",{for:"content",class:"form-label"},"說明內容",-1),Ue={class:"mb-3"},ye=e("span",null,"上架狀態",-1),Ve={class:"form-check form-switch"},ke={class:"form-check-label",for:"is_enabled"},Me={key:0},Ce={key:1},xe={class:"modal-footer"};function Ae(i,t,d,m,o,l){const p=h("VField"),_=h("ErrorMessage"),b=h("ckeditor"),u=h("VForm");return n(),c("div",G,[e("div",q,[e("div",O,[e("div",j,[e("h5",z,[this.isNew?(n(),c("span",J,"新增商品")):(n(),c("span",Q,"編輯商品"))]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:t[0]||(t[0]=(...s)=>l.close&&l.close(...s))})]),e("div",H,[e("div",K,[e("div",W,[X,y(e("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":t[1]||(t[1]=s=>o.tempProducts.imageUrl=s)},null,512),[[V,o.tempProducts.imageUrl]]),d.tempProduct.imageUrl?(n(),c("img",{key:0,class:"img-fluid",src:d.tempProduct.imageUrl,alt:d.tempProduct.imageUrl},null,8,Y)):g("",!0),e("input",{type:"file",class:"form-control",onChange:t[2]||(t[2]=(...s)=>l.uploadFile&&l.uploadFile(...s)),ref:"files"},null,544),d.tempProduct.imgPreviewURL?(n(),c("img",{key:1,class:"img-fluid",src:d.tempProduct.imgPreviewURL},null,8,Z)):g("",!0),e("button",{class:"btn btn-primary text-white",type:"button",onClick:t[3]||(t[3]=D((...s)=>l.upload&&l.upload(...s),["prevent"])),disabled:!this.file},"確認上傳",8,$),ee,Array.isArray(d.tempProduct.imagesUrl)?(n(),c("div",te,[(n(!0),c(M,null,C(d.tempProduct.imagesUrl,(s,r)=>(n(),c("div",{class:"mb-3",key:r+123},[oe,y(e("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":x=>o.tempProducts.imagesUrl[r]=x},null,8,se),[[V,o.tempProducts.imagesUrl[r]]]),e("img",{class:"img-fluid",src:s,alt:s},null,8,le)]))),128)),d.tempProduct.imagesUrl.length===0||d.tempProduct.imagesUrl[d.tempProduct.imagesUrl.length-1]?(n(),c("button",{key:0,class:"btn btn-outline-primary btn-sm d-block w-100",onClick:t[4]||(t[4]=(...s)=>l.createImages&&l.createImages(...s))}," 新增圖片 ")):g("",!0),e("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:t[5]||(t[5]=s=>o.tempProducts.imagesUrl.pop())}," 刪除圖片 ")])):g("",!0)]),a(u,{class:"col-sm-8",ref:"form"},{default:L(({errors:s})=>[e("div",ie,[de,a(p,{id:"title",name:"標題",type:"text",class:P(["form-control",{"is-invalid":s.標題}]),placeholder:"請輸入標題",modelValue:o.tempProducts.title,"onUpdate:modelValue":t[6]||(t[6]=r=>o.tempProducts.title=r),rules:"required"},null,8,["modelValue","class"]),a(_,{name:"標題",class:"invalid-feedback"}),e("div",re,[e("div",ae,[ne,a(p,{id:"category",name:"分類",type:"text",class:P(["form-control",{"is-invalid":s.分類}]),placeholder:"請輸入分類",modelValue:o.tempProducts.category,"onUpdate:modelValue":t[7]||(t[7]=r=>o.tempProducts.category=r),rules:"required"},null,8,["modelValue","class"]),a(_,{name:"分類",class:"invalid-feedback"})]),e("div",ce,[ue,a(p,{id:"unit",name:"單位",type:"text",class:P(["form-control",{"is-invalid":s.單位}]),placeholder:"請輸入單位",modelValue:o.tempProducts.unit,"onUpdate:modelValue":t[8]||(t[8]=r=>o.tempProducts.unit=r),rules:"required"},null,8,["modelValue","class"]),a(_,{name:"單位",class:"invalid-feedback"})])]),e("div",me,[e("div",pe,[_e,a(p,{id:"origin_price",name:"原價",type:"number",min:"0",class:P(["form-control",{"is-invalid":s.原價}]),placeholder:"請輸入原價",modelValue:o.tempProducts.origin_price,"onUpdate:modelValue":t[9]||(t[9]=r=>o.tempProducts.origin_price=r),modelModifiers:{number:!0},rules:"required"},null,8,["modelValue","class"]),a(_,{name:"原價",class:"invalid-feedback"})]),e("div",he,[fe,a(p,{id:"price",name:"售價",type:"number",min:"0",class:P(["form-control",{"is-invalid":s.售價}]),placeholder:"請輸入售價",modelValue:o.tempProducts.price,"onUpdate:modelValue":t[10]||(t[10]=r=>o.tempProducts.price=r),modelModifiers:{number:!0},rules:"required"},null,8,["modelValue","class"]),a(_,{name:"售價",class:"invalid-feedback"})])]),Pe,e("div",be,[ge,a(b,{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述",editor:o.editor,modelValue:o.tempProducts.description,"onUpdate:modelValue":t[11]||(t[11]=r=>o.tempProducts.description=r),config:o.editorConfig},null,8,["editor","modelValue","config"])]),e("div",ve,[we,a(b,{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容",editor:o.editor,config:o.editorConfig,modelValue:o.tempProducts.content,"onUpdate:modelValue":t[12]||(t[12]=r=>o.tempProducts.content=r)},null,8,["editor","config","modelValue"])]),e("div",Ue,[ye,e("div",Ve,[y(e("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[13]||(t[13]=r=>o.tempProducts.is_enabled=r)},null,512),[[R,o.tempProducts.is_enabled]]),e("label",ke,[o.tempProducts.is_enabled?(n(),c("span",Me,"已上架")):(n(),c("span",Ce,"未上架"))])])])])]),_:1},512)])]),e("div",xe,[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:t[14]||(t[14]=(...s)=>l.close&&l.close(...s))}," 取消 "),e("button",{type:"submit",class:"btn btn-primary",onClick:t[15]||(t[15]=(...s)=>l.updateProduct&&l.updateProduct(...s))}," 確認 ")])])])],512)}const Ie=k(S,[["render",Ae]]);var Ee={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"leo535",BASE_URL:"/flash-taste/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:w,VITE_APP_API_NAME:U}=Ee,De={data(){return{tempProduct:{imagesUrl:[]},products:[],checkUserStatus:"",isNew:!1,page:{}}},methods:{getProducts(i=1){const t=this.$loading.show();this.axios.get(`${w}/api/${U}/admin/products/?page=${i}`).then(d=>{this.products=d.data.products,this.page=d.data.pagination,t.hide()}).catch(d=>{f.fire({position:"top-end",icon:"error",title:d.response.data.message,showConfirmButton:!1,timer:1500})})},openModal(i,t){i==="new"?(this.tempProduct={imagesUrl:[]},this.isNew=!0):(this.tempProduct={...t},Array.isArray(this.tempProduct.imagesUrl)||(this.tempProduct.imagesUrl=[]),this.isNew=!1),this.$refs.userProductModal.open()},delProductModal(i){this.tempProduct={...i},this.$refs.userDeleteModal.open()},deleteProduct(){this.axios.delete(`${w}/api/${U}/admin/product/${this.tempProduct.id}`).then(i=>{f.fire({position:"top-end",icon:"success",title:i.data.message,showConfirmButton:!1,timer:1500}),this.$refs.userDeleteModal.close()}).catch(i=>{f.fire({position:"top-end",icon:"error",title:i.response.data.message,showConfirmButton:!1,timer:1500})})},updateProduct(){let i="",t="post";this.isNew?i=`${w}/api/${U}/admin/product`:(i=`${w}/api/${U}/admin/product/${this.tempProduct.id}`,t="put");const d={data:this.tempProduct};this.axios[t](i,d).then(m=>{f.fire({position:"top-end",icon:"success",title:m.data.message,showConfirmButton:!1,timer:1500}),this.$refs.userProductModal.close()}).catch(m=>{f.fire({position:"top-end",icon:"error",title:m.response.data.message,showConfirmButton:!1,timer:1500})})},createImages(){this.tempProduct.imagesUrl.push("")}},components:{ProductModalView:Ie,PaginationCom:N,DeleteProductModal:I},mounted(){this.getProducts()}},Le={class:"row"},Re=e("h2",null,"商品管理",-1),Ne={class:"text-end mt-4"},Te={class:"table-responsive mb-3"},Be={class:"table mt-4"},Fe=e("thead",null,[e("tr",null,[e("th",{class:"text-nowrap"}," 分類 "),e("th",{class:"text-nowrap"},"商品名稱"),e("th",{class:"text-nowrap"}," 原價 "),e("th",{class:"text-nowrap"}," 售價 "),e("th",{class:"text-nowrap"}," 上架狀態 "),e("th",{class:"text-nowrap"}," 操作行為 ")])],-1),Se={class:"text-end"},Ge={class:"text-end"},qe={key:0,class:"text-success"},Oe={key:1},je={class:"text-nowrap"},ze={class:"btn-group"},Je=["onClick"],Qe=["onClick"];function He(i,t,d,m,o,l){const p=h("PaginationCom"),_=h("ProductModalView"),b=h("DeleteProductModal");return n(),c("div",Le,[Re,e("div",Ne,[e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=u=>l.openModal("new"))}," 建立新的商品 ")]),e("div",Te,[e("table",Be,[Fe,e("tbody",null,[(n(!0),c(M,null,C(o.products,u=>(n(),c("tr",{key:"id"+u.id},[e("td",null,v(u.category),1),e("td",null,v(u.title),1),e("td",Se,v(i.$filters.currency(u.origin_price)),1),e("td",Ge,v(i.$filters.currency(u.price)),1),e("td",null,[u.is_enabled?(n(),c("span",qe,"已上架")):(n(),c("span",Oe,"未上架"))]),e("td",je,[e("div",ze,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:s=>l.openModal("edit",u)}," 編輯 ",8,Je),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:s=>l.delProductModal(u)}," 刪除 ",8,Qe)])])]))),128))])])]),a(p,{"page-info":o.page,onGetProducts:l.getProducts},null,8,["page-info","onGetProducts"]),a(_,{ref:"userProductModal",onGetProducts:l.getProducts,"temp-product":o.tempProduct,"is-new":o.isNew,onUpdateData:l.updateProduct,onCreateImg:l.createImages},null,8,["onGetProducts","temp-product","is-new","onUpdateData","onCreateImg"]),a(b,{ref:"userDeleteModal",onGetProducts:l.getProducts,"temp-product":o.tempProduct,onDeleteData:l.deleteProduct},null,8,["onGetProducts","temp-product","onDeleteData"])])}const $e=k(De,[["render",He]]);export{$e as default};
