import{M as I,D as U}from"./DeleteProductModal-QQm4bR96.js";import{C as N}from"./ckeditor-MBwnBHUZ.js";import{_ as M,r as p,o as i,c as o,a as e,b as d,w as E,n as k,j as g,F as V,g as P,k as x,E as C,J as B,t as v}from"./index-nUkNPI7V.js";import{P as L}from"./PaginationCom-UZt_RlON.js";import{S as f}from"./sweetalert2.all-LXIH1u7k.js";const S={props:["tempArticle","isNew"],data(){return{articleModal:"",tempArticles:{},create_at:"",editor:N,editorConfig:{toolbar:["heading","|","bold","italic","link","bulletedList","numberedList","blockQuote","undo","redo"]}}},methods:{open(){this.articleModal.show()},close(){this.articleModal.hide(),this.$emit("getProducts")},updateArticle(){this.$emit("updateData")},createImages(){this.$emit("createImg")}},watch:{tempArticle(){this.tempArticles=this.tempArticle,this.tempArticles.images||(this.tempArticles.images=[]),this.tempArticles.image||(this.tempArticles.image=""),[this.create_at]=new Date(this.tempArticles.create_at*1e3).toISOString().split("T")},create_at(){this.tempArticles.create_at=Math.floor(new Date(this.create_at)/1e3)}},mounted(){this.articleModal=new I(this.$refs.articleModal,{keyboard:!1,backdrop:"static"})}},T={class:"modal fade",ref:"articleModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},G={class:"modal-dialog modal-xl",role:"document"},R={class:"modal-content border-0"},q={class:"modal-header bg-dark text-white"},O={class:"modal-title",id:"exampleModalLabel"},F={key:0},j={key:1},z=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),J={class:"modal-body"},Q={class:"row"},H={class:"col-sm-4"},K={class:"mb-3"},W=e("label",{for:"title",class:"form-label"},"標題",-1),X={class:"mb-3"},Y=e("label",{for:"image",class:"form-label"},"文章圖片",-1),Z=["src","alt"],$=e("h3",null,"新增多圖",-1),ee={key:1,class:"mb-2"},te=e("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),se=["onUpdate:modelValue"],le=["src","alt"],ie={class:"mb-3"},oe=e("label",{for:"author",class:"form-label"},"作者",-1),ae={class:"mb-3"},ne=e("label",{for:"create_at"},"文章建立日期",-1),re={class:"col-sm-8"},ce=e("label",{for:"tag",class:"form-label"},"標籤",-1),de={key:0,class:"row gx-1 mb-3"},me={class:"input-group input-group-sm"},pe=["onClick"],ue=e("i",{class:"bi bi-x"},null,-1),_e=[ue],he={class:"col-md-2 mb-1"},be={class:"mb-3"},ge=e("label",{for:"description",class:"form-label"},"文章描述",-1),fe={class:"mb-3"},Ae={class:"mb-3"},we=e("span",null,"上架狀態",-1),ve={class:"form-check form-switch"},ye={class:"form-check-label",for:"isPublic"},ke={key:0},xe={key:1},Ve={class:"modal-footer"};function Pe(l,s,c,_,t,n){const u=p("v-field"),h=p("error-message"),y=p("v-form"),m=p("ckeditor");return i(),o("div",T,[e("div",G,[e("div",R,[e("div",q,[e("h5",O,[c.isNew?(i(),o("span",F,"新增文章")):(i(),o("span",j,"編輯文章"))]),z]),e("div",J,[e("div",Q,[e("div",H,[d(y,null,{default:E(({errors:r})=>[e("div",K,[W,d(u,{type:"text",name:"標題",class:k(["form-control",{"is-invalid":r.標題}]),id:"title",modelValue:t.tempArticles.title,"onUpdate:modelValue":s[0]||(s[0]=a=>t.tempArticles.title=a),placeholder:"請輸入標題",rules:"required"},null,8,["modelValue","class"]),d(h,{name:"標題",class:"invalid-feedback"})]),e("div",X,[Y,d(u,{type:"text",name:"文章圖片",class:k(["form-control",{"is-invalid":r.文章圖片}]),id:"image",modelValue:t.tempArticles.image,"onUpdate:modelValue":s[1]||(s[1]=a=>t.tempArticles.image=a),placeholder:"請輸入圖片連結",rules:"required"},null,8,["modelValue","class"]),t.tempArticles.image?(i(),o("img",{key:0,class:"img-fluid",src:t.tempArticles.image,alt:t.tempArticles.image},null,8,Z)):g("",!0),d(h,{name:"文章圖片",class:"invalid-feedback"}),$,Array.isArray(t.tempArticles.images)?(i(),o("div",ee,[(i(!0),o(V,null,P(t.tempArticles.images,(a,b)=>(i(),o("div",{class:"mb-3",key:b+123},[te,x(e("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":D=>t.tempArticles.images[b]=D},null,8,se),[[C,t.tempArticles.images[b]]]),e("img",{class:"img-fluid",src:a,alt:a},null,8,le)]))),128)),t.tempArticles.images.length===0||t.tempArticles.images[t.tempArticles.images.length-1]?(i(),o("button",{key:0,type:"button",class:"btn btn-outline-primary btn-sm d-block w-100",onClick:s[2]||(s[2]=(...a)=>n.createImages&&n.createImages(...a))}," 新增圖片 ")):g("",!0),e("button",{type:"button",class:"btn btn-outline-danger btn-sm d-block w-100",onClick:s[3]||(s[3]=a=>t.tempArticles.images.pop())}," 刪除圖片 ")])):g("",!0)]),e("div",ie,[oe,d(u,{type:"text",name:"作者",class:k(["form-control",{"is-invalid":r.作者}]),id:"author",modelValue:t.tempArticles.author,"onUpdate:modelValue":s[4]||(s[4]=a=>t.tempArticles.author=a),placeholder:"請輸入標題",rules:"required"},null,8,["modelValue","class"]),d(h,{name:"作者",class:"invalid-feedback"})]),e("div",ae,[ne,x(e("input",{type:"date",name:"文章建立日期",class:"form-control",id:"create_at","onUpdate:modelValue":s[5]||(s[5]=a=>t.create_at=a)},null,512),[[C,t.create_at]])])]),_:1})]),e("div",re,[ce,Array.isArray(t.tempArticles.tag)?(i(),o("div",de,[(i(!0),o(V,null,P(t.tempArticles.tag,(r,a)=>(i(),o("div",{class:"col-md-2 mb-1",key:a},[e("div",me,[d(u,{type:"text",name:"標籤",class:"form-control form-control",id:"tag",modelValue:t.tempArticles.tag[a],"onUpdate:modelValue":b=>t.tempArticles.tag[a]=b,placeholder:"請輸入標籤"},null,8,["modelValue","onUpdate:modelValue"]),e("button",{type:"button",class:"btn btn-outline-danger",onClick:()=>t.tempArticles.tag.splice(a,1)},_e,8,pe)])]))),128)),e("div",he,[t.tempArticles.tag.length===0||t.tempArticles.tag[t.tempArticles.tag.length-1]?(i(),o("button",{key:0,class:"btn btn-outline-primary btn-sm d-block w-100",type:"button",onClick:s[6]||(s[6]=()=>t.tempArticles.tag.push(""))}," 新增標籤 ")):g("",!0)])])):g("",!0),e("div",be,[ge,d(m,{type:"text",class:"form-control",id:"description",editor:t.editor,config:t.editorConfig,modelValue:t.tempArticles.description,"onUpdate:modelValue":s[7]||(s[7]=r=>t.tempArticles.description=r),placeholder:"請輸入文章描述"},null,8,["editor","config","modelValue"])]),e("div",fe,[d(m,{type:"text",class:"form-control",editor:t.editor,config:t.editorConfig,modelValue:t.tempArticles.content,"onUpdate:modelValue":s[8]||(s[8]=r=>t.tempArticles.content=r)},null,8,["editor","config","modelValue"])]),e("div",Ae,[we,e("div",ve,[x(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[9]||(s[9]=r=>t.tempArticles.isPublic=r),id:"isPublic"},null,512),[[B,t.tempArticles.isPublic]]),e("label",ye,[t.tempArticles.isPublic?(i(),o("span",ke,"已上架")):(i(),o("span",xe,"未上架"))])])])])])]),e("div",Ve,[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:s[10]||(s[10]=(...r)=>n.close&&n.close(...r))}," 取消 "),e("button",{type:"button",class:"btn btn-primary",onClick:s[11]||(s[11]=(...r)=>n.updateArticle&&n.updateArticle(...r))}," 確認 ")])])])],512)}const Ce=M(S,[["render",Pe]]);var Me={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"leo535",BASE_URL:"/flash-taste/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:A,VITE_APP_API_NAME:w}=Me,De={data(){return{articles:[],articlesingle:[],page:{},isNew:!1,tempArticle:{}}},methods:{getArticle(l=1){const s=this.$loading.show();this.axios.get(`${A}/api/${w}/admin/articles/?page=${l}`).then(c=>{this.articles=c.data.articles,this.page=c.data.pagination,s.hide()}).catch(c=>{f.fire({position:"top-end",icon:"error",title:c.response.data.message,showConfirmButton:!1,timer:1500})})},getArticlesingle(l){const s=this.$loading.show();this.axios.get(`${A}/api/${w}/admin/article/${l}`).then(c=>{this.articlesingle=c.data.article,this.isNew=!1,this.openModal("edit",this.articlesingle),s.hide()}).catch(c=>{f.fire({position:"top-end",icon:"error",title:c.response.data.message,showConfirmButton:!1,timer:1500})})},openModal(l,s){l==="new"?(this.tempArticle={title:"預設標題",isPublic:!1,create_at:new Date().getTime()/1e3,tag:[],content:"預設內容",images:[]},this.isNew=!0):l==="edit"&&(this.tempArticle={...s},Array.isArray(this.tempArticle.images)||(this.tempArticle.images=[]),this.isNew=!1),this.$refs.articleModal.open()},delArticleModal(l){this.tempArticle={...l},this.$refs.userDeleteModal.open()},deleteArticle(){this.axios.delete(`${A}/api/${w}/admin/article/${this.tempArticle.id}`).then(l=>{f.fire({position:"top-end",icon:"success",title:l.data.message,showConfirmButton:!1,timer:1500}),this.getArticle(),this.$refs.userDeleteModal.close()}).catch(l=>{f.fire({position:"top-end",icon:"error",title:l.response.data.message,showConfirmButton:!1,timer:1500})})},updateArticle(){let l="",s="post";this.isNew?l=`${A}/api/${w}/admin/article`:(l=`${A}/api/${w}/admin/article/${this.tempArticle.id}`,s="put");const c={data:this.tempArticle};this.axios[s](l,c).then(_=>{f.fire({position:"top-end",icon:"success",title:_.data.message,showConfirmButton:!1,timer:1500}),this.$refs.articleModal.close(),this.getArticle()}).catch(_=>{alert(_.response.data.message)})},createImages(){this.tempArticle.images.push("")}},components:{ArticleModalView:Ce,DeleteProductModal:U,PaginationCom:L},mounted(){this.getArticle()}},Ie={class:"container"},Ue={class:"row"},Ne=e("h2",null,"文章管理",-1),Ee={class:"py-0"},Be={class:"text-end mt-4"},Le={class:"table-responsive"},Se={class:"table mt-4"},Te=e("thead",null,[e("tr",null,[e("th",{class:"text-nowrap"},"標題"),e("th",null,"作者"),e("th",null,"描述"),e("th",null,"建立時間"),e("th",{class:"text-nowrap"},"上架狀態"),e("th",{class:"text-nowrap"},"操作行為")])],-1),Ge={class:"text-nowrap"},Re={class:"text-nowrap"},qe={class:"text-truncate d-inline-block",style:{width:"100px"}},Oe={class:"text-nowrap"},Fe={key:0},je={key:1},ze={class:"text-nowrap"},Je={class:"btn-group"},Qe=["onClick"],He=["onClick"];function Ke(l,s,c,_,t,n){const u=p("ArticleModalView"),h=p("DeleteProductModal"),y=p("PaginationCom");return i(),o("div",Ie,[e("div",Ue,[Ne,e("div",Ee,[e("div",Be,[e("button",{class:"btn btn-primary",type:"button",onClick:s[0]||(s[0]=()=>n.openModal("new"))}," 建立新的文章 ")]),e("div",Le,[e("table",Se,[Te,e("tbody",null,[(i(!0),o(V,null,P(t.articles,m=>(i(),o("tr",{key:m.id},[e("td",Ge,v(m.title),1),e("td",Re,v(m.author),1),e("td",null,[e("span",qe,v(m.description),1)]),e("td",Oe,v(l.$filters.date(m.create_at)),1),e("td",null,[m.isPublic?(i(),o("span",Fe,"已上架")):(i(),o("span",je,"未上架"))]),e("td",ze,[e("div",Je,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:()=>n.getArticlesingle(m.id)}," 編輯 ",8,Qe),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:()=>n.delArticleModal(m)}," 刪除 ",8,He)])])]))),128))])])]),d(u,{ref:"articleModal",onGetProducts:n.getArticle,"temp-article":t.tempArticle,"is-new":t.isNew,onUpdateData:n.updateArticle,onCreateImg:n.createImages},null,8,["onGetProducts","temp-article","is-new","onUpdateData","onCreateImg"]),d(h,{ref:"userDeleteModal",onGetProducts:n.getArticle,"temp-product":t.tempArticle,onDeleteData:n.deleteArticle,id:4},null,8,["onGetProducts","temp-product","onDeleteData"]),d(y,{"page-info":t.page,onGetProducts:n.getArticle},null,8,["page-info","onGetProducts"])])])])}const et=M(De,[["render",Ke]]);export{et as default};
