import{M as k}from"./modal-iN8-bLta.js";import{_ as y,o,c as d,a as t,t as s,j as $,k as M,J as v,F as b,g,i as C,r as _,b as p}from"./index-zLiU2U1g.js";import{D}from"./DeleteProductModal-SmAqsT0N.js";import{P as V}from"./PaginationCom-5inicFhf.js";import{S as O}from"./sweetalert2.all-MZ4wuwUD.js";const E={props:["temp-order"],data(){return{orderModal:""}},methods:{open(){this.orderModal.show()},close(){this.orderModal.hide(),this.$emit("getProducts")},changestatus(e){this.$emit("changeStatus",e)}},mounted(){this.orderModal=new k(this.$refs.orderModal,{keyboard:!1,backdrop:"static"})}},A={ref:"orderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},x={class:"modal-dialog modal-xl",role:"document"},L={class:"modal-content border-0"},S=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),I={class:"modal-body"},N={class:"row"},B={class:"col-md-4"},G=t("h3",null,"用戶資料",-1),R={class:"table"},T={key:0},U=t("th",{style:{width:"100px"}},"姓名",-1),q=t("th",null,"Email",-1),F=t("th",null,"電話",-1),j=t("th",null,"地址",-1),J={class:"col-md-8"},z=t("h3",null,"訂單細節",-1),H={class:"table"},K=t("th",{style:{width:"100px"}},"訂單編號",-1),Q=t("th",null,"下單時間",-1),W=t("th",null,"付款時間",-1),X={key:0},Y={key:1},Z=t("th",null,"付款狀態",-1),tt={class:"form-check form-switch"},et={class:"form-check-label",for:"flexCheckDefault"},st={key:0,class:"text-success"},ot={key:1,class:"text-muted"},dt=t("th",null,"總金額",-1),lt=t("h3",null,"選購商品",-1),at={class:"table"},rt=t("thead",null,[t("tr")],-1),nt={class:"text-end"},it={class:"modal-footer"};function ct(e,a,l,P,u,r){return o(),d("div",A,[t("div",x,[t("div",L,[S,t("div",I,[t("div",N,[t("div",B,[G,t("table",R,[e.tempOrder.user?(o(),d("tbody",T,[t("tr",null,[U,t("td",null,s(e.tempOrder.user.name),1)]),t("tr",null,[q,t("td",null,s(e.tempOrder.user.email),1)]),t("tr",null,[F,t("td",null,s(e.tempOrder.user.tel),1)]),t("tr",null,[j,t("td",null,s(e.tempOrder.user.address),1)])])):$("",!0)])]),t("div",J,[z,t("table",H,[t("tbody",null,[t("tr",null,[K,t("td",null,s(e.tempOrder.id),1)]),t("tr",null,[Q,t("td",null,s(e.$filters.date(e.tempOrder.create_at)),1)]),t("tr",null,[W,t("td",null,[e.tempOrder.paid_date?(o(),d("span",X,s(e.$filters.date(e.tempOrder.paid_date)),1)):(o(),d("span",Y))])]),t("tr",null,[Z,t("td",null,[t("div",tt,[M(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":a[0]||(a[0]=n=>e.tempOrder.is_paid=n)},null,512),[[v,e.tempOrder.is_paid]]),t("label",et,[e.tempOrder.is_paid?(o(),d("span",st,"已付款")):(o(),d("span",ot,"未付款"))])])])]),t("tr",null,[dt,t("td",null,s(e.$filters.currency(e.tempOrder.total)),1)])])]),lt,t("table",at,[rt,t("tbody",null,[(o(!0),d(b,null,g(e.tempOrder.products,n=>{var h;return o(),d("tr",{key:n.id},[t("th",null,s((h=n.product)==null?void 0:h.title),1),t("td",null,s(n.qty)+" / "+s(n.product.unit),1),t("td",nt,s(n.final_Total),1)])}),128))])])])])]),t("div",it,[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:a[1]||(a[1]=(...n)=>r.close&&r.close(...n))}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:a[2]||(a[2]=C(()=>r.changestatus(e.tempOrder),["prevent"]))}," 修改付款狀態 ")])])])],512)}const ut=y(E,[["render",ct]]);var ht={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"leo535",BASE_URL:"/flash-taste/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:m,VITE_APP_API_NAME:f}=ht,_t={data(){return{orderList:[],isNew:!1,tempOrder:{},page:{}}},methods:{getOrders(e=1){const a=this.$loading.show();this.axios.get(`${m}/api/${f}/admin/orders/?page=${e}`).then(l=>{this.orderList=l.data.orders,this.page=l.data.pagination,a.hide()}).catch(l=>{console.log(l.response.data.message)})},openModal(e){this.tempOrder={...e},this.isNew=!1,this.$refs.customerorderModal.open()},delProductModal(e){this.tempOrder={...e},this.$refs.deleteProductmodal.open()},deleteOrder(){this.axios.delete(`${m}/api/${f}/admin/order/${this.tempOrder.id}`).then(e=>{O.fire({position:"top-end",icon:"success",title:e.data.message,showConfirmButton:!1,timer:1500}),this.getOrders()}).catch(e=>{console.log(e.response.data.message)}),this.$refs.deleteProductmodal.close()},updatePaid(e){if(e.is_paid){const l=Math.floor(new Date/1e3);e.paid_date=l}else e.paid_date="";const a={is_paid:e.is_paid,paid_date:e.paid_date};this.axios.put(`${m}/api/${f}/admin/order/${e.id}`,{data:a}).then(l=>{this.getOrders(),O.fire({position:"top-end",icon:"success",title:l.data.message,showConfirmButton:!1,timer:1500}),this.$refs.customerorderModal.close()}).catch(l=>{console.log(l)})}},components:{OrderModalView:ut,DeleteModalView:D,PaginationCom:V},mounted(){this.getOrders()}},pt={class:"row"},mt=t("h2",null,"訂單管理",-1),ft={class:"table-responsive"},bt={class:"table mt-4 mb-3"},gt=t("thead",null,[t("tr",null,[t("th",{class:"text-nowrap"}," 購買時間 "),t("th",{class:"text-nowrap"}," Email "),t("th",{class:"text-nowrap"}," 購買款項 "),t("th",{class:"text-nowrap"}," 應付金額 "),t("th",{class:"text-nowrap"}," 付款狀態 "),t("th",{class:"text-nowrap"}," 操作行為 ")])],-1),Ot={key:0},yt={class:"list-unstyled"},$t={class:"text-end"},Pt={key:0,class:"text-success"},wt={key:1},kt={class:"text-nowrap"},Mt={class:"btn-group"},vt=["onClick"],Ct=["onClick"];function Dt(e,a,l,P,u,r){const n=_("OrderModalView"),h=_("DeleteModalView"),w=_("PaginationCom");return o(),d("div",pt,[mt,t("div",ft,[t("table",bt,[gt,t("tbody",null,[(o(!0),d(b,null,g(u.orderList,i=>(o(),d("tr",{key:i.id},[t("td",null,s(e.$filters.date(i.create_at)),1),t("td",null,[i.user?(o(),d("span",Ot,s(i.user.email),1)):$("",!0)]),t("td",null,[t("ul",yt,[(o(!0),d(b,null,g(i.products,c=>(o(),d("li",{key:c.id},s(c.product.title)+" 數量 :"+s(c.qty)+" :"+s(c.product.unit),1))),128))])]),t("td",$t,s(e.$filters.currency(i.total)),1),t("td",null,[i.is_paid?(o(),d("span",Pt,"已付款")):(o(),d("span",wt,"未付款"))]),t("td",kt,[t("div",Mt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:c=>r.openModal(i)}," 編輯 ",8,vt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:c=>r.delProductModal(i)}," 刪除 ",8,Ct)])])]))),128))])])]),p(n,{ref:"customerorderModal",onGetProducts:r.getOrders,"temp-order":u.tempOrder,onChangeStatus:r.updatePaid},null,8,["onGetProducts","temp-order","onChangeStatus"]),p(h,{ref:"deleteProductmodal",onGetProducts:r.getOrders,"temp-product":u.tempOrder,onDeleteData:r.deleteOrder,id:2},null,8,["onGetProducts","temp-product","onDeleteData"]),p(w,{"page-info":u.page,onGetProducts:r.getOrders},null,8,["page-info","onGetProducts"])])}const St=y(_t,[["render",Dt]]);export{St as default};
